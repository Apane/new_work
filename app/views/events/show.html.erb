<script type="text/javascript">
  function initialize() {
    var myLatlng = new google.maps.LatLng(<%= @event.lat %>,<%= @event.lng %>);
    var mapOptions = {
      zoom: 15,
      center: myLatlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      disableDefaultUI: true
    }
    var map = new google.maps.Map(document.getElementById('map'), mapOptions);

    var marker = new google.maps.Marker({
        position: myLatlng,
        map: map,
        title: '<%= @event.title %>'
    });
  }

  google.maps.event.addDomListener(window, 'load', initialize);
</script>

<div class="row">
  <div class="span3">
    <%#= render 'home/sidebar' %>
    <h5>Owner</h5>
    <%= simple_user_avatar(@event.user) %>
    <hr>
    <h5>Interesting people</h5>
     <% @interesting_people.each do |person| %>
       <% if person.first_name.present? %>
       <%= simple_user_avatar(person) %>
      <% end %>
    <% end %>
    <hr>
    <h5>Recently visited</h5>
    <% @event.event_participants.order('created_at desc').limit(5).map(&:user).each do |p| %>
    <%= simple_user_avatar(p) %>
    <% end %>
  </div>
  <div class="span6">
    <h4>
      <%= @event.title %>
    </h4>
    <div style='width: 100%;'>
      <div id="map" style='width: 100%; height: 250px;'></div>
    </div>
    <div class="events_list">
      <h5><i class="fa fa-calendar-o"></i> <%= @event.date.strftime("%A, %B %d, %Y") %></h5>
      <h5><i class="fa fa-clock-o"></i> <%= @event.time %></h5>
      <h5><i class="fa fa-map-marker"></i> <%= @event.location %></h5>
    </div>
    <p>
      <%= simple_format(sanitize(@event.description)) %>
    </p>
    <div class="name"></div>
    <br />
    <medium><strong align-"center"><%= pluralize(@participants.size.to_s, 'person') %> attending this event</strong></medium> <br /><br />
    <div class="event_participants">
      <% @event.participants.each do |p| %>
        <div class="event_particpant participant_<%= p.id %>">
          <%= simple_user_avatar(p) %>
          <p><%= p.name %></p>
          <div><%= "Owner" if @event.owner_is?(p) %></div>
        </div>
      <% end %>
    </div>

    <div class="clearfix"></div>
    <div class="name"></div>
    <%= form_for [@event, @comment], remote: true do |f| %>
      <div><%= f.hidden_field :user_id, value: current_user.id %></div>
      <div>
        <%= f.text_area :body, rows: 5,  placeholder: "Leave a comment", class: 'comment-area'  %>
        <div class="comment_errors"></div>
      </div>
      <%= f.submit "Post Comment", class: 'btn btn-primary pull-right' %>
    <% end %>
    <div id="comments">
      <%= render @event.root_comments %>
    </div>
  </div>
  <div class="span3">
    <div class="attend_button">
      <%= attend_to_event(@event) %>
      <div class="clearfix"></div>
    </div>
    <%= link_to 'Edit event', edit_event_path(@event), class: 'btn pull-right' if @event.owner_is?(current_user) %>
  </div>
</div>
<%#= render 'shared/footer' %>

<script type="text/javascript">
$('.add_event').click(function(event) {
  $('.new_event_form').css('display', 'block');
});
$('.cancel_event').click(function(event) {
  $('.new_event_form').css('display', 'none');
});
</script>

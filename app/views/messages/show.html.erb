<script type="text/javascript">
  $(function() {
    var faye = new Faye.Client('http://localhost:9292/faye');
    faye.subscribe("/messages/for/conversation/<%= @conversation.id %>", function (data) {
      eval(data);
    });
    faye.subscribe("/notifications/for/conversation/<%= @conversation.id %>/user/<%= current_user.id %>", function (data) {
      eval(data);
    });
  });
</script>
<div class="row">
  <div class="span3">
    <%#= render 'home/sidebar' %>
    <h5>Interesting people</h5>
     <% @interesting_people.each do |person| %>
       <% if person.first_name.present? %>
       <%= simple_user_avatar(person) %>
      <% end %>
    <% end %>
  </div>
  <div class="span6">
    <%= render 'messages_menu' %>
    <div class="messages">
      <%= render @messages %>
    </div>
    <%= form_for current_user.sent_messages.new, class: 'form', remote: true do |f| %>
      <%= f.text_area :body, rows: 5, placeholder: 'Write a reply...', class: 'span6' %>
      <div>
        <%= f.hidden_field :recipient_id, value: message_receiver(@conversation) %>
        <%= f.hidden_field :conversation_id, value: @conversation.id %>
      </div>
      <div class="pull-left alertBox"></div>
      <%= f.submit 'Reply', class: 'btn btn-primary pull-right' %>
    <% end %>
  </div>
  <div class="span3"></div>
</div>
<script type="text/javascript">
  $(function() {
    var messageText = $("#message_body");

    if (localStorage) {
      var content = localStorage.getItem("autosave_<%= @conversation.id %>");
      if (content) {
          messageText.text(content);
      }
    }

    messageText.autoSave(function() {
      // var time = showTime();
      $(".alertBox").empty().append($('<div class="alert alert-danger"><span class="alertMessage"></span></div>'));
      // $(".alertMessage").text("Saved as draft" + time);
      $(".alertMessage").text("Saved as draft");
      // $(".alert").alert();
    }, 500, "<%= @conversation.id %>");

    // $("#refresh").click(function() {
    //   location.reload(true);
    // });

    // $("#clear").click(function() {
    //   localStorage.clear();
    //   location.reload(true);
    // });
  });
</script>
